/*! lan.js@0.0.1 2013-10-20 */
(function(){var a=function(a,b){for(var c in b)a[c]=b[c]},b=function(a,b){for(var c=0;c<a.length;c++)b(a[c],c)},c={HIDDEN_STYLE:"position:fixed;top:-500px;left:-500px;visibility:hidden;"},d=function(a){a=a||{};var b=a.url||"about:blank",d=document.createElement("iframe");return d.setAttribute("style",c.HIDDEN_STYLE),d.setAttribute("src",b),d};this.lan=this.lan||{},this.lan.utils={create_iframe:d,constants:c,merge:a,each:b}}).call(window),function(){var a=10,b=1500,c=10,d=2e3,e=[1,7,9,11,13,15,17,19,20,21,22,23,25,37,42,43,53,77,79,87,95,101,102,103,104,109,110,111,113,115,117,119,123,135,139,143,179,389,465,512,513,514,515,526,530,531,532,540,556,563,587,601,636,993,995,2049,4045,6e3],f=function(a){if(!a)throw"TcpProbe needs an address param.";this.fire=function(b){var c=a.match(/\:(\d+)$/)||["","80"],d=parseInt(c[1],10);"WebSocket"in window&&e.indexOf(d)<0?this._send_websocket_request(b):this._send_img_request(b)},this._send_websocket_request=function(b){var e=new Date;try{var f=new WebSocket("ws://"+a)}catch(g){return b("error",0)}var h=function(){var a=new Date-e;return a>d?b("timeout",a):0!==f.readyState?b("up",a):(setTimeout(h,c),void 0)};setTimeout(h,c)},this._send_img_request=function(b){var c=null,e=new Date,f=new Image,g=function(){return new Date-e},h=function(){return f?(f=null,clearTimeout(c),b("up",g())):void 0},i=function(){f&&(f=null,b("timeout",g()))};c=setTimeout(i,d),f.onload=f.onerror=h,f.src=window.location.protocol+"//"+a}},g=function(c){if(!c)throw"TcpScan requests addresses param.";c.constructor!=Array&&(c=[c]);var d=[];this.start=function(e){for(var g,h=0,i=new Date,j=function(g){var j=h*a+g;if(!(j>=c.length)){var k=c[j];setTimeout(function(){var a=new f(k);a.fire(function(a,b){e.stream&&e.stream(k,a,b),d.push({address:k,state:a,duration:b}),d.length>=c.length&&e.complete&&(e.complete(d,new Date-i),e.complete=null)})},h*b)}}(g);h*a<c.length;){for(g=0;a>g;g++)j(g);h++}}};lan.utils.merge(lan,{TcpScan:g})}.call(window),function(){var a=function(a){var b=this,c=document.createElement("img");c.setAttribute("style",lan.utils.constants.HIDDEN_STYLE),document.body.appendChild(c),this.fire=function(d){c.onerror=c.onload=function(){a.width||a.height?d(!(a.width&&c.width!==a.width||a.height&&c.height!==a.height),b):d(c.width>0&&c.height>0,b),b.cleanup()},c.src=a.url},this.cleanup=function(){c.onerror=c.onload=null,c&&(c.parentNode&&c.parentNode.removeChild(c),c=null)}},b=function(a){var b=this,c=null,d=null,e=null;e=lan.utils.create_iframe(),e.contentDocument.write("<html>"+a.html+"</html>"),document.body.appendChild(e),this.fire=function(f){c=f;var g=document.createElement("link");g.setAttribute("href",a.url),e.contentDocument.body.appendChild(g),d=setInterval(b._poll,b.constructor.POLL_INTERVAL)},this.cleanup=function(){e&&(e.parentNode&&e.parentNode.removeChild(e),e=null),d&&(clearInterval(d),d=null),c=null},this._poll=function(){var d=e.contentDocument.getElementById(a.id);if(d){for(var f in styles)if(d.style[f]!==styles[f])return;c&&c(!0,this),b.cleanup()}}};b.POLL_INTERVAL=10;var c=function(){this.fire=function(){}};c.POLL_INTERVAL=10;var d=function(a,b){this.check=function(c){var d=this.constructor.PROBES[a];return d?(new d(b).fire(c),void 0):(c&&c(!1),console.log("Error: invalid type '"+(a||"")+"'"),!1)}};d.PROBES={image:a,css:b,js:c},d.db=[];var e=function(a){if(!a)throw"DeviceScan requests addresses param.";a.constructor!=Array&&(a=[a]),this.start=function(b){var c=new lan.TcpScan(a);c.start({stream:function(a,c){c&&lan.utils.each(d.db,function(c){c.check(function(d){d&&b.found&&b.found(a,c)})})},complete:function(a){b.complete&&b.complete(a)}})}};e.start=function(a,b){new e(a).start(b)},lan.utils.merge(lan,{DeviceScan:e,DeviceFingerprint:d})}.call(window);